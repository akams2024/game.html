
<!DOCTYPE html>
<html lang="ku">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Akam Domena</title>
  <style>
    body {
      margin: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: url('https://i.imgur.com/ZulI9A7.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }

    .form {
      text-align: center;
      padding: 30px;
      background-color: rgba(0, 0, 0, 0.7);
      max-width: 400px;
      margin: 80px auto;
      border-radius: 20px;
      box-shadow: 0px 0px 15px #000;
    }

    input, button {
      margin: 10px;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }

    button {
      background-color: #ff9800;
      color: white;
      cursor: pointer;
    }

    #gameArea {
      display: none;
      text-align: center;
      padding: 20px;
    }

    canvas {
      background-color: white;
      border: 3px solid black;
      border-radius: 15px;
      box-shadow: 0px 0px 15px #000;
    }

    .scoreboard {
      display: flex;
      justify-content: space-around;
      margin-bottom: 15px;
    }

    .player {
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 15px;
      width: 45%;
    }

    .player h3 {
      margin: 0;
      font-size: 20px;
    }

    .chatbox {
      margin-top: 20px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .chatbox input {
      width: 70%;
    }

    .chatbox button {
      width: 25%;
    }
  </style>
</head>
<body>
  <div class="form">
    <h1>Akam Domena</h1>
    <input type="text" id="playerName" placeholder="ناوی خۆت بنووسە"/>
    <input type="text" id="roomCode" placeholder="کۆدی ڕووم"/>
    <button id="createRoom">درووستکردنی ڕووم</button>
    <button id="joinRoom">جۆینی ڕووم</button>
  </div>

  <div id="gameArea">
    <div class="scoreboard">
      <div class="player"><h3 id="p1name">Player 1</h3><div>نمرە: <span id="p1score">0</span></div></div>
      <div class="player"><h3 id="p2name">Player 2</h3><div>نمرە: <span id="p2score">0</span></div></div>
    </div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <div class="chatbox">
      <input type="text" id="chatInput" placeholder="پەیام بنووسە..." />
      <button onclick="sendChat()">ناردن</button>
      <div id="chatLog" style="text-align:left;margin-top:10px;"></div>
    </div>
  </div>

  <script type="module">
    const gameCanvas = document.getElementById("gameCanvas");
    const ctx = gameCanvas.getContext("2d");
    const playerNameInput = document.getElementById("playerName");
    const roomCodeInput = document.getElementById("roomCode");
    const createRoomButton = document.getElementById("createRoom");
    const joinRoomButton = document.getElementById("joinRoom");
    const gameArea = document.getElementById("gameArea");
    const chatLog = document.getElementById("chatLog");
    const chatInput = document.getElementById("chatInput");
    const p1name = document.getElementById("p1name");
    const p2name = document.getElementById("p2name");

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, get, push } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB91Fp5HlY69-k_9k1TsSWOR4aiklpRKfI",
      authDomain: "akam-domenos.firebaseapp.com",
      projectId: "akam-domenos",
      storageBucket: "akam-domenos.firebasestorage.app",
      messagingSenderId: "243125791523",
      appId: "1:243125791523:web:a18e6ba126beca28deba96"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentRoom = "";

    function showGameCanvas() {
      document.querySelector(".form").style.display = "none";
      gameArea.style.display = "block";
    }

    function drawDomino(x, y, value1, value2) {
      ctx.fillStyle = "#eee";
      ctx.fillRect(x, y, 60, 120);
      ctx.fillStyle = "#000";
      ctx.fillRect(x + 28, y, 4, 120);
      ctx.fillStyle = "#333";
      ctx.font = "20px Arial";
      ctx.fillText(value1, x + 20, y + 30);
      ctx.fillText(value2, x + 20, y + 90);
    }

    function sendChat() {
      const msg = chatInput.value.trim();
      if (msg === "") return;
      push(ref(db, "rooms/" + currentRoom + "/chat"), {
        from: playerNameInput.value,
        msg: msg
      });
      chatInput.value = "";
    }

    function listenToChat() {
      onValue(ref(db, "rooms/" + currentRoom + "/chat"), (snapshot) => {
        chatLog.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          chatLog.innerHTML += `<div><b>${data.from}:</b> ${data.msg}</div>`;
        });
      });
    }

    createRoomButton.onclick = async () => {
      const playerName = playerNameInput.value.trim();
      const roomCode = roomCodeInput.value.trim();
      if (!playerName || !roomCode) return alert("زانیاری بنووسە");

      await set(ref(db, "rooms/" + roomCode), {
        player1: playerName,
        chat: []
      });

      p1name.innerText = playerName;
      currentRoom = roomCode;
      showGameCanvas();
      drawDomino(100, 100, 3, 6);
      listenToChat();
    };

    joinRoomButton.onclick = async () => {
      const playerName = playerNameInput.value.trim();
      const roomCode = roomCodeInput.value.trim();
      if (!playerName || !roomCode) return alert("زانیاری بنووسە");

      const roomRef = ref(db, "rooms/" + roomCode);
      const snapshot = await get(roomRef);

      if (snapshot.exists()) {
        await set(ref(db, "rooms/" + roomCode + "/player2"), playerName);
        p1name.innerText = snapshot.val().player1;
        p2name.innerText = playerName;
        currentRoom = roomCode;
        showGameCanvas();
        drawDomino(100, 100, 5, 2);
        listenToChat();
      } else {
        alert("کۆدی ڕووم نەدروستە");
      }
    };
  </script>
</body>
</html>
